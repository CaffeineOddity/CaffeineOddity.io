import{j as s,b as i,c as a,aa as n}from"./chunks/framework.Dkh8-idd.js";const F=JSON.parse('{"title":"CentOS 上安装 Nginx","description":"","frontmatter":{"title":"CentOS 上安装 Nginx","date":"2024-03-21T01:22:31.000Z","tags":["后端","Nginx"],"categories":["后端","Nginx"],"cover":"https://miro.medium.com/v2/resize:fit:1200/0*mjG1YdoT7xPcnznN.jpg","hiddenCover":true},"headers":[],"relativePath":"sop/article/backend_dev/nginx/01.cenos_install_nginx.md","filePath":"sop/article/backend_dev/nginx/01.cenos_install_nginx.md","lastUpdated":1712178944000}'),e={name:"sop/article/backend_dev/nginx/01.cenos_install_nginx.md"},l=n(`<h1 id="在centos上安装nginx" tabindex="-1">在CentOS上安装Nginx <a class="header-anchor" href="#在centos上安装nginx" aria-label="Permalink to &quot;在CentOS上安装Nginx&quot;">​</a></h1><p>最近在云服务器上部署nginx服务，遇到了安装不上问题，整理一下解决过程。</p><h4 id="使用包管理器安装nginx" tabindex="-1">使用包管理器安装Nginx <a class="header-anchor" href="#使用包管理器安装nginx" aria-label="Permalink to &quot;使用包管理器安装Nginx&quot;">​</a></h4><ol><li><strong>启用EPEL软件源</strong> EPEL（Extra Packages for Enterprise Linux）是一个由Fedora特别兴趣小组创建、维护并管理的软件仓库，它为RHEL（Red Hat Enterprise Linux）及其衍生版本，如CentOS，提供额外的软件包。<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> epel-release</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clean</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> makecache</span></span></code></pre></div></li><li><strong>安装Nginx</strong><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span></code></pre></div></li></ol><h4 id="启动和设置nginx服务" tabindex="-1">启动和设置Nginx服务 <a class="header-anchor" href="#启动和设置nginx服务" aria-label="Permalink to &quot;启动和设置Nginx服务&quot;">​</a></h4><ol><li><strong>启动Nginx服务</strong><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span></code></pre></div></li><li><strong>设置开机自启动</strong><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span></code></pre></div></li><li><strong>检查Nginx服务状态</strong><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span></code></pre></div></li></ol><h4 id="配置防火墙" tabindex="-1">配置防火墙 <a class="header-anchor" href="#配置防火墙" aria-label="Permalink to &quot;配置防火墙&quot;">​</a></h4><p>如果您的系统上启用了防火墙，确保允许HTTP（80）和HTTPS（443）通信。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --permanent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-service=http</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --permanent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-service=https</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --reload</span></span></code></pre></div><h4 id="编译安装nginx-可选" tabindex="-1">编译安装Nginx（可选） <a class="header-anchor" href="#编译安装nginx-可选" aria-label="Permalink to &quot;编译安装Nginx（可选）&quot;">​</a></h4><p>如果需要从源代码编译安装Nginx，可以按照以下步骤：</p><ol><li>安装编译工具和依赖库：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> groupinstall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Development Tools&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openssl-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pcre-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zlib-devel</span></span></code></pre></div></li><li>下载Nginx源代码并解压：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://nginx.org/download/nginx-1.21.3.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zxvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-1.21.3.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-1.21.3</span></span></code></pre></div></li><li>配置、编译和安装：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./configure</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre></div></li><li>启动Nginx：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/nginx/sbin/nginx</span></span></code></pre></div></li><li>将Nginx添加到系统服务（可选）： 可以创建一个系统服务文件，以便更容易地管理Nginx服务。</li></ol><h3 id="报错问题解决" tabindex="-1">报错问题解决 <a class="header-anchor" href="#报错问题解决" aria-label="Permalink to &quot;报错问题解决&quot;">​</a></h3><p>如果您遇到“bash: nginx: command not found”的错误，可能是因为：</p><ol><li><strong>PATH环境变量：</strong> <code>nginx</code>命令的路径可能没有添加到您的<code>PATH</code>环境变量中。</li><li><strong>权限问题：</strong> <code>nginx</code>可执行文件可能没有执行权限。 解决方法：</li><li><strong>临时添加到PATH：</strong><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PATH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$PATH</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:/usr/local/nginx/sbin</span></span></code></pre></div></li><li><strong>永久添加到PATH：</strong> 编辑<code>.bash_profile</code>或<code>.bashrc</code>文件：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bash_profile</span></span></code></pre></div>添加：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PATH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$PATH</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:/usr/local/nginx/sbin</span></span></code></pre></div>保存并退出，然后执行：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bash_profile</span></span></code></pre></div></li><li><strong>检查和设置权限：</strong><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chown</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lighthouse:lighthouse</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/nginx/sbin/nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/nginx/sbin/nginx</span></span></code></pre></div>替换<code>lighthouse</code>为您的实际用户名。</li></ol><h3 id="启动nginx" tabindex="-1">启动Nginx <a class="header-anchor" href="#启动nginx" aria-label="Permalink to &quot;启动Nginx&quot;">​</a></h3><p>如果需要重新启动Nginx服务，可以使用：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span></code></pre></div><p>以上就是在CentOS上安装和配置Nginx的详细步骤。希望对您有所帮助。</p><h2 id="nginx-启动失败原因" tabindex="-1">nginx 启动失败原因 <a class="header-anchor" href="#nginx-启动失败原因" aria-label="Permalink to &quot;nginx 启动失败原因&quot;">​</a></h2><ul><li>错误：nginx.service 不存在 创建<code>nginx.service</code>: 执行<code>sudo vi /usr/lib/systemd/system/nginx.service </code><br> 写入以下内容：</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=The NGINX HTTP and reverse proxy server</span></span>
<span class="line"><span>After=syslog.target network.target remote-fs.target nss-lookup.target</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>Type=forking</span></span>
<span class="line"><span>PIDFile=/usr/local/nginx/logs/nginx.pid</span></span>
<span class="line"><span>ExecStartPre=/usr/local/nginx/sbin/nginx -t</span></span>
<span class="line"><span>ExecStart=/usr/local/nginx/sbin/nginx</span></span>
<span class="line"><span>ExecReload=/usr/local/nginx/sbin/nginx  -s reload</span></span>
<span class="line"><span>ExecStop=/usr/local/nginx/sbin/nginx -s quit</span></span>
<span class="line"><span>ExecStopPost=/bin/rm -f /usr/local/nginx/logs/nginx.pid</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=multi-user.target</span></span></code></pre></div><p>然后执行<code>sudo systemctl daemon-reload</code>使配置生效</p><ul><li>其他错误 <ol><li>Can&#39;t open PID file /run/nginx.pid (yet?) after start: No such file or directory</li><li>/usr/bin/env nginx -t (code=exited, status=127)</li></ol></li></ul><p>这里错误原因主要是由于安装nginx位置的不同，然后配置<code>nginx.service</code>又没有指定正确位置的原因导致 比如PIDFile、ExecStopPost指定的nginx.pid,都声明在 /run/目录下面。可能由于权限原因，导致每次启动的时候都创建失败。</p><p>nginx.pid的作用是每次启动的时候，把进程写入到该文件中。让nignx服务知道自己的进程id.</p><p>正确的配置方法： 找到你自己nginx的路径，通常三方安装路径在/usr/local/nginx里面。 nginx.service 的StartPre检测、Start启动、Reload重启、Stop停止和StopPost等，都指定到你安装的nginx路径。</p>`,27),t=[l];function p(h,d,k,o,g,r){return i(),a("div",null,t)}const u=s(e,[["render",p]]);export{F as __pageData,u as default};
